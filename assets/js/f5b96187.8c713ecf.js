"use strict";(self.webpackChunkstm_32_documentaion=self.webpackChunkstm_32_documentaion||[]).push([[851],{8437:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"ServoMotor/Code","title":"Code","description":"Task: To interface Servo Motor with STM32","source":"@site/docs/ServoMotor/Code.md","sourceDirName":"ServoMotor","slug":"/ServoMotor/Code","permalink":"/stm32docs/docs/ServoMotor/Code","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/ServoMotor/Code.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"ServoMotor","permalink":"/stm32docs/docs/ServoMotor/"},"next":{"title":"16x2 I2C_LCD Display","permalink":"/stm32docs/docs/LCD_Display/"}}');var r=s(4848),i=s(8453);const o={},c="Code",l={},d=[{value:"Step 1: Create a STM32 Project &quot;Servo&quot;",id:"step-1-create-a-stm32-project-servo",level:3},{value:"Step 2: Clock Configuration",id:"step-2-clock-configuration",level:3},{value:"Step 3: Pinout &amp; Configuration",id:"step-3-pinout--configuration",level:3},{value:"Timer Configuration- TIM2",id:"timer-configuration--tim2",level:4},{value:"Step 4: Code Snippet to Control Servo Rotation",id:"step-4-code-snippet-to-control-servo-rotation",level:3}];function a(e){const n={code:"code",h1:"h1",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"code",children:"Code"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Task: To interface Servo Motor with STM32"})}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-a-stm32-project-servo",children:'Step 1: Create a STM32 Project "Servo"'}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"step-2-clock-configuration",children:"Step 2: Clock Configuration"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Select ",(0,r.jsx)(n.code,{children:"HSE"})," in the ",(0,r.jsx)(n.strong,{children:"PLL Source Mux"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Select ",(0,r.jsx)(n.code,{children:"PLLCLK"})," in the ",(0,r.jsx)(n.strong,{children:"System Clock Mux"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"HCLK (MHz)"})," is set at ",(0,r.jsx)(n.code,{children:"180"})," Mhz, and press Enter"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["After the clock is initialized, select the ",(0,r.jsx)(n.strong,{children:"APB1 Prescaler"})," as ",(0,r.jsx)(n.code,{children:"/8"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["We use the ",(0,r.jsx)(n.strong,{children:"TIM2"})," for the ",(0,r.jsx)(n.strong,{children:"PWM"}),", which is connected to the APB1 Bus"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"APB1 Timer clock"})," is at ",(0,r.jsx)(n.strong,{children:"45 MHz"})," right now"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Image",src:s(5627).A+"",width:"1395",height:"487"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-pinout--configuration",children:"Step 3: Pinout & Configuration"}),"\n",(0,r.jsx)(n.h4,{id:"timer-configuration--tim2",children:"Timer Configuration- TIM2"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Image",src:s(1144).A+"",width:"975",height:"557"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Mode:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Set the ",(0,r.jsx)(n.strong,{children:"Clock source"})," as ",(0,r.jsx)(n.code,{children:"internal clock"}),", which is at 45 MHz (same as APB1)"]}),"\n",(0,r.jsxs)(n.li,{children:["Select the ",(0,r.jsx)(n.code,{children:"PWM channel"})," for the Timer, in ",(0,r.jsx)(n.strong,{children:"Channel 1"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Under parameter settings:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Set ",(0,r.jsx)(n.strong,{children:"Prescalar"})," value as ",(0,r.jsx)(n.code,{children:"90-1"})]}),"\n",(0,r.jsxs)(n.li,{children:["Set ",(0,r.jsx)(n.strong,{children:"Counter Period"})," as ",(0,r.jsx)(n.code,{children:"10000-1"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Pinout:"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Image",src:s(7703).A+"",width:"1009",height:"463"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Set Pin ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"PA0"})})," as the ",(0,r.jsx)(n.strong,{children:"PWM output"})," Pin and we will connect it to the Servo Motor Signal pin."]}),"\n",(0,r.jsxs)(n.li,{children:["The output Frequency of the PWM signal depends on 3 parameters- ",(0,r.jsx)(n.strong,{children:"Timer Clock, ARR and Prescaler"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"step-4-code-snippet-to-control-servo-rotation",children:"Step 4: Code Snippet to Control Servo Rotation"}),"\n",(0,r.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,r.jsx)(n.code,{children:"/* USER CODE BEGIN PFP */"})," in ",(0,r.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"int angle(int val);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,r.jsx)(n.code,{children:"/* USER CODE BEGIN 2 */"})," in ",(0,r.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"HAL_TIM_PWM_Start(&htim2, TIM_CHANNEL_1);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,r.jsx)(n.code,{children:"While (1)"})," in ",(0,r.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"__HAL_TIM_SET_COMPARE(&htim2,TIM_CHANNEL_1, angle(0));\r\nHAL_Delay(1000);\r\n__HAL_TIM_SET_COMPARE(&htim2,TIM_CHANNEL_1, angle(90));\r\nHAL_Delay(1000);\r\n__HAL_TIM_SET_COMPARE(&htim2,TIM_CHANNEL_1, angle(180));\r\nHAL_Delay(1000);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,r.jsx)(n.code,{children:"/* USER CODE BEGIN 4 */"})," in ",(0,r.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"int angle(int val){\r\n\tint per_deg = 5.55;  //pulse value for 1\xb0 Rotation\r\n\tint pulse = 250 + (val * per_deg);  // calculate pulse value, starting from 25\r\n\treturn pulse;\r\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},5627:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/3-a9d6def4d40a187fd228899ab8b3dc4e.png"},1144:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/8-7b6c65f5be398be47774c6dc8c0be775.png"},7703:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/Servo-a3287f7a1636aa12916dd8f848df0697.png"},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var t=s(6540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);